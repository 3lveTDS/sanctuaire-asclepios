<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Sanctuaire d'Asclépios</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            font-family: sans-serif;
            background-color: #111;
            color: #eee;
        }
        #sidebar {
            display: flex;
            flex-direction: column;
            margin-right: 40px;
            border-right: 1px solid #444;
            padding-right: 10px;
            height: 800px;
        }
        #reset-button {
            margin-bottom: 10px;
            padding: 6px;
            font-size: 0.9em;
            background-color: #222;
            border: 1px solid #777;
            color: #eee;
            cursor: pointer;
        }
        #list {
            display: grid;
            grid-template-columns: repeat(4, 60px);
            grid-gap: 4px;
            overflow-y: scroll;
            flex-grow: 1;
        }
        #canvas {
            position: relative;
            width: 800px;
            height: 800px;
            background-color: #000; /* FOND NOIR */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dot {
            position: absolute;
            width: 20px;         /* Augmenté pour faciliter la grille */
            height: 20px;
            border-radius: 0;    /* Bords droits */
            background-color: #444; /* Gris par défaut */
            transition: background-color 0.3s, box-shadow 0.3s;
            margin: 0;
            z-index: 1;
        }
        .dot.pulse {
            animation: pulse 0.6s ease-out;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0px 4px #fff0; }
            50% { box-shadow: 0 0 16px 8px #fff8; }
            100% { box-shadow: 0 0 0px 4px #fff0; }
        }
        #progress {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #222;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <button id="reset-button" onclick="resetAll()">Réinitialiser</button>
        <div id="list"></div>
    </div>
    <div id="canvas">
        <div id="progress">Progression : 0 / 367</div>
    </div>
    <script>
        // === PARAMÈTRES ===
        const N = 367;
        // Ordre : gris > rouge > bleu > vert
        const levels = ["#444", "#e74c3c", "#3498db", "#27ae60"]; 
        const state = JSON.parse(localStorage.getItem("asclepiosState") || "{}");

        // Grille compacte (carré le plus proche de racine(N))
        const gridSize = Math.ceil(Math.sqrt(N)); // 20x20 max pour 367
        const cellSize = 20;  // px
        const offsetX = (800 - gridSize * cellSize) / 2;
        const offsetY = (800 - gridSize * cellSize) / 2;

        const canvas = document.getElementById("canvas");
        const list = document.getElementById("list");
        const progress = document.getElementById("progress");

        let dots = {};

        function updateProgress() {
            let count = Object.values(state).filter(v => v > 0).length;
            progress.textContent = `Progression : ${count} / ${N}`;
        }

        function resetAll() {
            if (!confirm("Réinitialiser tous les progrès ?")) return;
            for (let i = 1; i <= N; i++) {
                state[i] = 0;
                dots[i].style.backgroundColor = levels[0];
            }
            localStorage.setItem("asclepiosState", JSON.stringify(state));
            updateProgress();
        }

        // Placer les carrés sur une grille compacte, sans espace
        for (let i = 1; i <= N; i++) {
            const row = Math.floor((i - 1) / gridSize);
            const col = (i - 1) % gridSize;
            const dot = document.createElement("div");
            dot.className = "dot";
            dot.style.left = `${offsetX + col * cellSize}px`;
            dot.style.top = `${offsetY + row * cellSize}px`;
            dot.dataset.index = i;
            dot.title = `Item ${i}`;
            canvas.appendChild(dot);
            dots[i] = dot;
        }

        for (let i = 1; i <= N; i++) {
            const btn = document.createElement("button");
            btn.className = "btn";
            btn.textContent = i;
            btn.onclick = () => {
                state[i] = (state[i] || 0) + 1;
                if (state[i] >= levels.length) state[i] = 0;
                dots[i].style.backgroundColor = levels[state[i]];
                dots[i].classList.add('pulse');
                setTimeout(() => dots[i].classList.remove('pulse'), 600);
                localStorage.setItem("asclepiosState", JSON.stringify(state));
                updateProgress();
            };
            list.appendChild(btn);

            // Appliquer l'état initial
            if (typeof state[i] !== "undefined") {
                dots[i].style.backgroundColor = levels[state[i]];
            }
        }

        updateProgress();
    </script>
</body>
</html>
