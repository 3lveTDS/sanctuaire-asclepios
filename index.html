
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Sanctuaire d'Asclépios – Spirale</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            font-family: sans-serif;
            background-color: #111;
            color: #eee;
        }
        #sidebar {
            display: flex;
            flex-direction: column;
            margin-right: 40px;
            border-right: 1px solid #444;
            padding-right: 10px;
            height: 800px;
        }
        #reset-button {
            margin-bottom: 10px;
            padding: 6px;
            font-size: 0.9em;
            background-color: #222;
            border: 1px solid #777;
            color: #eee;
            cursor: pointer;
        }
        #list {
            display: grid;
            grid-template-columns: repeat(4, 60px);
            grid-gap: 4px;
            overflow-y: scroll;
            flex-grow: 1;
        }
        #canvas {
            position: relative;
            width: 800px;
            height: 800px;
            background-color: #fff;
        }
        .dot {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 3px;
            background-color: transparent;
            transition: background-color 0.3s ease;
        }
        .btn {
            cursor: pointer;
            background: none;
            border: 1px solid #777;
            color: #eee;
            padding: 4px;
            font-size: 0.8em;
        }
        #progress {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #222;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #ccc;
        }
    </style>

    <style>
        .dot:hover::after {
            content: attr(data-index);
            position: absolute;
            top: -20px;
            left: 20px;
            background: #000;
            color: #fff;
            padding: 2px 4px;
            font-size: 0.7em;
            border-radius: 3px;
            white-space: nowrap;
        }
        .dot.pulse {
            animation: pulse 1s ease-out;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0px gold; }
            50% { box-shadow: 0 0 10px 5px gold; }
            100% { box-shadow: 0 0 0px gold; }
        }
        #connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 800px;
            height: 800px;
            z-index: 0;
        }
        .dot {
            z-index: 1;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <button id="reset-button" onclick="resetAll()">Réinitialiser</button>
        <div id="list"></div>
    </div>
    <div id="canvas"><svg id="connections"></svg>
        <div id="progress">Progression : 0 / 367</div>
    </div>

    <script>
        const N = 367;
        const levels = ["transparent", "gray", "black", "gold"];
        const positions = [{"x": 400, "y": 400}, {"x": 420, "y": 400}, {"x": 420, "y": 420}, {"x": 400, "y": 420}, {"x": 380, "y": 420}, {"x": 380, "y": 400}, {"x": 380, "y": 380}, {"x": 400, "y": 380}, {"x": 420, "y": 380}, {"x": 440, "y": 380}, {"x": 440, "y": 400}, {"x": 440, "y": 420}, {"x": 440, "y": 440}, {"x": 420, "y": 440}, {"x": 400, "y": 440}, {"x": 380, "y": 440}, {"x": 360, "y": 440}, {"x": 360, "y": 420}, {"x": 360, "y": 400}, {"x": 360, "y": 380}, {"x": 360, "y": 360}, {"x": 380, "y": 360}, {"x": 400, "y": 360}, {"x": 420, "y": 360}, {"x": 440, "y": 360}, {"x": 460, "y": 360}, {"x": 460, "y": 380}, {"x": 460, "y": 400}, {"x": 460, "y": 420}, {"x": 460, "y": 440}, {"x": 460, "y": 460}, {"x": 440, "y": 460}, {"x": 420, "y": 460}, {"x": 400, "y": 460}, {"x": 380, "y": 460}, {"x": 360, "y": 460}, {"x": 340, "y": 460}, {"x": 340, "y": 440}, {"x": 340, "y": 420}, {"x": 340, "y": 400}, {"x": 340, "y": 380}, {"x": 340, "y": 360}, {"x": 340, "y": 340}, {"x": 360, "y": 340}, {"x": 380, "y": 340}, {"x": 400, "y": 340}, {"x": 420, "y": 340}, {"x": 440, "y": 340}, {"x": 460, "y": 340}, {"x": 480, "y": 340}, {"x": 480, "y": 360}, {"x": 480, "y": 380}, {"x": 480, "y": 400}, {"x": 480, "y": 420}, {"x": 480, "y": 440}, {"x": 480, "y": 460}, {"x": 480, "y": 480}, {"x": 460, "y": 480}, {"x": 440, "y": 480}, {"x": 420, "y": 480}, {"x": 400, "y": 480}, {"x": 380, "y": 480}, {"x": 360, "y": 480}, {"x": 340, "y": 480}, {"x": 320, "y": 480}, {"x": 320, "y": 460}, {"x": 320, "y": 440}, {"x": 320, "y": 420}, {"x": 320, "y": 400}, {"x": 320, "y": 380}, {"x": 320, "y": 360}, {"x": 320, "y": 340}, {"x": 320, "y": 320}, {"x": 340, "y": 320}, {"x": 360, "y": 320}, {"x": 380, "y": 320}, {"x": 400, "y": 320}, {"x": 420, "y": 320}, {"x": 440, "y": 320}, {"x": 460, "y": 320}, {"x": 480, "y": 320}, {"x": 500, "y": 320}, {"x": 500, "y": 340}, {"x": 500, "y": 360}, {"x": 500, "y": 380}, {"x": 500, "y": 400}, {"x": 500, "y": 420}, {"x": 500, "y": 440}, {"x": 500, "y": 460}, {"x": 500, "y": 480}, {"x": 500, "y": 500}, {"x": 480, "y": 500}, {"x": 460, "y": 500}, {"x": 440, "y": 500}, {"x": 420, "y": 500}, {"x": 400, "y": 500}, {"x": 380, "y": 500}, {"x": 360, "y": 500}, {"x": 340, "y": 500}, {"x": 320, "y": 500}, {"x": 300, "y": 500}, {"x": 300, "y": 480}, {"x": 300, "y": 460}, {"x": 300, "y": 440}, {"x": 300, "y": 420}, {"x": 300, "y": 400}, {"x": 300, "y": 380}, {"x": 300, "y": 360}, {"x": 300, "y": 340}, {"x": 300, "y": 320}, {"x": 300, "y": 300}, {"x": 320, "y": 300}, {"x": 340, "y": 300}, {"x": 360, "y": 300}, {"x": 380, "y": 300}, {"x": 400, "y": 300}, {"x": 420, "y": 300}, {"x": 440, "y": 300}, {"x": 460, "y": 300}, {"x": 480, "y": 300}, {"x": 500, "y": 300}, {"x": 520, "y": 300}, {"x": 520, "y": 320}, {"x": 520, "y": 340}, {"x": 520, "y": 360}, {"x": 520, "y": 380}, {"x": 520, "y": 400}, {"x": 520, "y": 420}, {"x": 520, "y": 440}, {"x": 520, "y": 460}, {"x": 520, "y": 480}, {"x": 520, "y": 500}, {"x": 520, "y": 520}, {"x": 500, "y": 520}, {"x": 480, "y": 520}, {"x": 460, "y": 520}, {"x": 440, "y": 520}, {"x": 420, "y": 520}, {"x": 400, "y": 520}, {"x": 380, "y": 520}, {"x": 360, "y": 520}, {"x": 340, "y": 520}, {"x": 320, "y": 520}, {"x": 300, "y": 520}, {"x": 280, "y": 520}, {"x": 280, "y": 500}, {"x": 280, "y": 480}, {"x": 280, "y": 460}, {"x": 280, "y": 440}, {"x": 280, "y": 420}, {"x": 280, "y": 400}, {"x": 280, "y": 380}, {"x": 280, "y": 360}, {"x": 280, "y": 340}, {"x": 280, "y": 320}, {"x": 280, "y": 300}, {"x": 280, "y": 280}, {"x": 300, "y": 280}, {"x": 320, "y": 280}, {"x": 340, "y": 280}, {"x": 360, "y": 280}, {"x": 380, "y": 280}, {"x": 400, "y": 280}, {"x": 420, "y": 280}, {"x": 440, "y": 280}, {"x": 460, "y": 280}, {"x": 480, "y": 280}, {"x": 500, "y": 280}, {"x": 520, "y": 280}, {"x": 540, "y": 280}, {"x": 540, "y": 300}, {"x": 540, "y": 320}, {"x": 540, "y": 340}, {"x": 540, "y": 360}, {"x": 540, "y": 380}, {"x": 540, "y": 400}, {"x": 540, "y": 420}, {"x": 540, "y": 440}, {"x": 540, "y": 460}, {"x": 540, "y": 480}, {"x": 540, "y": 500}, {"x": 540, "y": 520}, {"x": 540, "y": 540}, {"x": 520, "y": 540}, {"x": 500, "y": 540}, {"x": 480, "y": 540}, {"x": 460, "y": 540}, {"x": 440, "y": 540}, {"x": 420, "y": 540}, {"x": 400, "y": 540}, {"x": 380, "y": 540}, {"x": 360, "y": 540}, {"x": 340, "y": 540}, {"x": 320, "y": 540}, {"x": 300, "y": 540}, {"x": 280, "y": 540}, {"x": 260, "y": 540}, {"x": 260, "y": 520}, {"x": 260, "y": 500}, {"x": 260, "y": 480}, {"x": 260, "y": 460}, {"x": 260, "y": 440}, {"x": 260, "y": 420}, {"x": 260, "y": 400}, {"x": 260, "y": 380}, {"x": 260, "y": 360}, {"x": 260, "y": 340}, {"x": 260, "y": 320}, {"x": 260, "y": 300}, {"x": 260, "y": 280}, {"x": 260, "y": 260}, {"x": 280, "y": 260}, {"x": 300, "y": 260}, {"x": 320, "y": 260}, {"x": 340, "y": 260}, {"x": 360, "y": 260}, {"x": 380, "y": 260}, {"x": 400, "y": 260}, {"x": 420, "y": 260}, {"x": 440, "y": 260}, {"x": 460, "y": 260}, {"x": 480, "y": 260}, {"x": 500, "y": 260}, {"x": 520, "y": 260}, {"x": 540, "y": 260}, {"x": 560, "y": 260}, {"x": 560, "y": 280}, {"x": 560, "y": 300}, {"x": 560, "y": 320}, {"x": 560, "y": 340}, {"x": 560, "y": 360}, {"x": 560, "y": 380}, {"x": 560, "y": 400}, {"x": 560, "y": 420}, {"x": 560, "y": 440}, {"x": 560, "y": 460}, {"x": 560, "y": 480}, {"x": 560, "y": 500}, {"x": 560, "y": 520}, {"x": 560, "y": 540}, {"x": 560, "y": 560}, {"x": 540, "y": 560}, {"x": 520, "y": 560}, {"x": 500, "y": 560}, {"x": 480, "y": 560}, {"x": 460, "y": 560}, {"x": 440, "y": 560}, {"x": 420, "y": 560}, {"x": 400, "y": 560}, {"x": 380, "y": 560}, {"x": 360, "y": 560}, {"x": 340, "y": 560}, {"x": 320, "y": 560}, {"x": 300, "y": 560}, {"x": 280, "y": 560}, {"x": 260, "y": 560}, {"x": 240, "y": 560}, {"x": 240, "y": 540}, {"x": 240, "y": 520}, {"x": 240, "y": 500}, {"x": 240, "y": 480}, {"x": 240, "y": 460}, {"x": 240, "y": 440}, {"x": 240, "y": 420}, {"x": 240, "y": 400}, {"x": 240, "y": 380}, {"x": 240, "y": 360}, {"x": 240, "y": 340}, {"x": 240, "y": 320}, {"x": 240, "y": 300}, {"x": 240, "y": 280}, {"x": 240, "y": 260}, {"x": 240, "y": 240}, {"x": 260, "y": 240}, {"x": 280, "y": 240}, {"x": 300, "y": 240}, {"x": 320, "y": 240}, {"x": 340, "y": 240}, {"x": 360, "y": 240}, {"x": 380, "y": 240}, {"x": 400, "y": 240}, {"x": 420, "y": 240}, {"x": 440, "y": 240}, {"x": 460, "y": 240}, {"x": 480, "y": 240}, {"x": 500, "y": 240}, {"x": 520, "y": 240}, {"x": 540, "y": 240}, {"x": 560, "y": 240}, {"x": 580, "y": 240}, {"x": 580, "y": 260}, {"x": 580, "y": 280}, {"x": 580, "y": 300}, {"x": 580, "y": 320}, {"x": 580, "y": 340}, {"x": 580, "y": 360}, {"x": 580, "y": 380}, {"x": 580, "y": 400}, {"x": 580, "y": 420}, {"x": 580, "y": 440}, {"x": 580, "y": 460}, {"x": 580, "y": 480}, {"x": 580, "y": 500}, {"x": 580, "y": 520}, {"x": 580, "y": 540}, {"x": 580, "y": 560}, {"x": 580, "y": 580}, {"x": 560, "y": 580}, {"x": 540, "y": 580}, {"x": 520, "y": 580}, {"x": 500, "y": 580}, {"x": 480, "y": 580}, {"x": 460, "y": 580}, {"x": 440, "y": 580}, {"x": 420, "y": 580}, {"x": 400, "y": 580}, {"x": 380, "y": 580}, {"x": 360, "y": 580}, {"x": 340, "y": 580}, {"x": 320, "y": 580}, {"x": 300, "y": 580}, {"x": 280, "y": 580}, {"x": 260, "y": 580}, {"x": 240, "y": 580}, {"x": 220, "y": 580}, {"x": 220, "y": 560}, {"x": 220, "y": 540}, {"x": 220, "y": 520}, {"x": 220, "y": 500}, {"x": 220, "y": 480}, {"x": 220, "y": 460}, {"x": 220, "y": 440}, {"x": 220, "y": 420}, {"x": 220, "y": 400}, {"x": 220, "y": 380}, {"x": 220, "y": 360}, {"x": 220, "y": 340}, {"x": 220, "y": 320}, {"x": 220, "y": 300}, {"x": 220, "y": 280}, {"x": 220, "y": 260}, {"x": 220, "y": 240}, {"x": 220, "y": 220}, {"x": 240, "y": 220}, {"x": 260, "y": 220}, {"x": 280, "y": 220}, {"x": 300, "y": 220}, {"x": 320, "y": 220}, {"x": 340, "y": 220}, {"x": 360, "y": 220}, {"x": 380, "y": 220}, {"x": 400, "y": 220}, {"x": 420, "y": 220}, {"x": 440, "y": 220}, {"x": 460, "y": 220}, {"x": 480, "y": 220}, {"x": 500, "y": 220}, {"x": 520, "y": 220}, {"x": 540, "y": 220}, {"x": 560, "y": 220}, {"x": 580, "y": 220}, {"x": 600, "y": 220}, {"x": 600, "y": 240}, {"x": 600, "y": 260}, {"x": 600, "y": 280}, {"x": 600, "y": 300}, {"x": 600, "y": 320}];
        const state = JSON.parse(localStorage.getItem("asclepiosState") || "{}");

        const canvas = document.getElementById("canvas");
        const list = document.getElementById("list");
        const progress = document.getElementById("progress");

        let dots = {};

        function updateProgress() {
            let count = Object.values(state).filter(v => v > 0).length;
            progress.textContent = `Progression : ${count} / ${N}`;
        }

        function resetAll() {
            if (!confirm("Réinitialiser tous les progrès ?")) return;
            for (let i = 1; i <= N; i++) {
                state[i] = 0;
                dots[i].style.backgroundColor = levels[0];
            }
            localStorage.setItem("asclepiosState", JSON.stringify(state));
            updateProgress();
            drawConnections();
        }


        for (let i = 1; i <= N; i++) {
            const pos = positions[i - 1];
            const dot = document.createElement("div");
            dot.className = "dot";
            dot.style.left = `${pos.x}px`;
            dot.style.top = `${pos.y}px`;
            dot.dataset.index = i;
            canvas.appendChild(dot);
            dots[i] = dot;
        }

        for (let i = 1; i <= N; i++) {
            const btn = document.createElement("button");
            btn.className = "btn";
            btn.textContent = i;
            btn.onclick = () => {
                state[i] = (state[i] || 0) + 1;
                if (state[i] >= levels.length) state[i] = 1;
                dots[i].style.backgroundColor = levels[state[i]];
                dots[i].classList.add('pulse');
                setTimeout(() => dots[i].classList.remove('pulse'), 1000);
                localStorage.setItem("asclepiosState", JSON.stringify(state));
                updateProgress();
                drawConnections();
            };
            list.appendChild(btn);

            if (state[i]) {
                dots[i].style.backgroundColor = levels[state[i]];
                dots[i].classList.add('pulse');
                setTimeout(() => dots[i].classList.remove('pulse'), 1000);
            }
        }

        
        const svg = document.getElementById("connections");

        function drawConnections() {
            svg.innerHTML = "";
            let completed = [];
            for (let i = 1; i <= N; i++) {
                if (state[i] && state[i] > 0) {
                    completed.push({ index: i, pos: positions[i - 1] });
                }
            }
            completed.sort((a, b) => a.index - b.index);
            for (let i = 0; i < completed.length - 1; i++) {
                const p1 = completed[i].pos;
                const p2 = completed[i + 1].pos;
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", p1.x + 7);  // offset to center of dot
                line.setAttribute("y1", p1.y + 7);
                line.setAttribute("x2", p2.x + 7);
                line.setAttribute("y2", p2.y + 7);
                line.setAttribute("stroke", "gold");
                line.setAttribute("stroke-width", "1");
                svg.appendChild(line);
            }
        }

        updateProgress();
        drawConnections();
    </script>
</body>
</html>
